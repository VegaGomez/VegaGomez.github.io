<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fruver ‚Äî Mercado Original</title>
  <style>
    /* ===== Theme & base ===== */
    :root{
      --bg:#fbfdf9;
      --panel:#ffffff;
      --accent-1:#0b6b3a; /* deep green */
      --accent-2:#ff7a18; /* warm orange */
      --muted:#61706b;
      --glass: rgba(255,255,255,0.75);
      --card-shadow: 0 10px 30px rgba(11,107,58,0.08);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#f2fbf6 0%,var(--bg) 100%);
      color:#0f1f1a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      background: linear-gradient(90deg,var(--accent-1), #1fbf6e);
      padding:20px 16px;
      color:white;
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:space-between;
      box-shadow: 0 8px 24px rgba(11,107,58,0.12);
    }
    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .logo{
      width:54px;height:54px;border-radius:12px;background:linear-gradient(180deg,#fff3e6,#fff);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent-1);
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    .brand h1{margin:0;font-size:20px;letter-spacing:-0.4px}
    .brand p{margin:0;font-size:12px;opacity:.95}
    .controls{display:flex;gap:12px;align-items:center}
    select, .btn-ghost{
      padding:8px 10px;border-radius:10px;border:none;background:rgba(255,255,255,0.12);color:white;font-weight:600;cursor:pointer;
    }

    /* ===== Layout ===== */
    main{max-width:1180px;margin:28px auto;padding:0 16px;display:grid;grid-template-columns:1fr 340px;gap:22px;align-items:start}
    @media(max-width:1000px){ main{grid-template-columns:1fr} }

    /* ===== Catalog area ===== */
    .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .section-header h2{margin:0;font-size:22px}
    .sections{background:transparent;padding:8px 0}

    .subsection{
      margin-bottom:28px;
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.9));
      padding:12px;border-radius:12px;box-shadow: var(--card-shadow);
      border-left:6px solid rgba(11,107,58,0.06);
    }
    .subsection h3{margin:0 0 8px 0;display:flex;align-items:center;gap:8px;font-size:16px}
    .subsection .hint{font-size:12px;color:var(--muted);margin-bottom:10px}

    .grid-products{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}

    /* ===== Product card (customized) ===== */
    .card{
      background:var(--panel);
      border-radius:12px;
      padding:12px;
      box-shadow:0 8px 30px rgba(11,107,58,0.04);
      transition:transform .22s ease, box-shadow .22s ease;
      position:relative; overflow:hidden;
      border:1px solid rgba(11,107,58,0.03);
    }
    .card:hover{ transform:translateY(-6px); box-shadow:0 18px 50px rgba(11,107,58,0.08) }
    .card .media{height:120px;border-radius:10px;overflow:hidden;margin-bottom:10px;background:#f3f3f3;display:flex;align-items:center;justify-content:center}
    .card .media img{width:100%;height:100%;object-fit:cover;display:block}

    .card h4{margin:0;font-size:16px}
    .card p.desc{margin:6px 0 10px;color:var(--muted);font-size:13px;min-height:36px}
    .price-row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px}
    .price{font-weight:800;color:var(--accent-1)}
    .price small{display:block;font-size:12px;color:var(--muted);font-weight:600}

    .card .controls{display:flex;gap:8px;align-items:center}
    .card input[type=number]{width:100px;padding:8px;border-radius:8px;border:1px solid #e9f0ea}
    .btn-add{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border:none;color:white;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 8px 18px rgba(255,122,24,0.08)}
    .btn-add:hover{transform:translateY(-3px)}

    /* Offer ribbon */
    .ribbon{position:absolute;left:-50px;top:12px;background:var(--accent-2);color:white;padding:6px 80px;transform:rotate(-35deg);font-weight:800;font-size:12px;box-shadow:0 6px 20px rgba(0,0,0,0.12)}

    /* ===== Cart panel (right) ===== */
    .cart{
      background: linear-gradient(180deg, rgba(255,255,255,0.9), var(--glass));
      padding:16px;border-radius:12px;box-shadow:var(--card-shadow);position:sticky;top:22px;height:fit-content;
    }
    .cart h3{margin:0 0 10px 0}
    .cart-list{max-height:420px;overflow:auto;margin-bottom:12px;padding:0;list-style:none}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:linear-gradient(90deg,#fff,#fbfff9);border:1px solid rgba(11,107,58,0.03);margin-bottom:8px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .cart-item .meta{flex:1}
    .cart-item .meta b{display:block}
    .cart-item small{color:var(--muted)}
    .cart-actions{display:flex;gap:8px;margin-top:8px}
    .btn-primary{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white;border:none;padding:10px;border-radius:10px;cursor:pointer;font-weight:800}
    .btn-secondary{background:transparent;border:1px solid rgba(11,107,58,0.12);padding:8px;border-radius:10px;cursor:pointer}

    /* ===== Footer ===== */
    footer{margin-top:28px;padding:22px;max-width:1180px;margin-left:auto;margin-right:auto;display:grid;grid-template-columns:1fr 1fr;gap:18px}
    .contact, .reviews{background:var(--panel);padding:16px;border-radius:12px;box-shadow:var(--card-shadow)}
    .contact input,.contact textarea{width:100%;padding:8px;margin-top:8px;border-radius:8px;border:1px solid #e9f0ea}
    .reviews ul{list-style:none;padding:0;margin:0}
    .review{padding:10px;border-radius:8px;margin-bottom:8px;background:linear-gradient(90deg,#f8fff7,#fff);border:1px solid rgba(11,107,58,0.03)}

    /* ===== Modal ===== */
    .modal{display:none;position:fixed;inset:0;z-index:9999;background:rgba(3,6,5,0.45);align-items:center;justify-content:center}
    .modal-card{background:var(--panel);padding:22px;border-radius:14px;max-width:420px;text-align:center;animation:modalIn .36s ease forwards}
    @keyframes modalIn{from{transform:scale(.86);opacity:0}to{transform:scale(1);opacity:1}}

    /* small screens */
    @media(max-width:900px){
      main{grid-template-columns:1fr;padding:8px}
      footer{grid-template-columns:1fr}
      .card .media{height:140px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">F</div>
      <div>
        <h1>Fruver ‚Ä¢ Mercado Original</h1>
        <p style="opacity:.9">Sabores locales ‚Äî dise√±o √∫nico</p>
      </div>
    </div>

    <div class="controls" aria-hidden>
      <label style="color:rgba(255,255,255,0.92);font-weight:700">Unidad</label>
      <select id="unit-select" title="Unidad (kg o lb)">
        <option value="kg">Kg</option>
        <option value="lb">Lb</option>
      </select>
      <button class="btn-ghost" onclick="mostrarSeccion('catalogo')">Cat√°logo</button>
    </div>
  </header>

  <main>
    <!-- left: catalog -->
    <div>
      <div class="section-header">
        <h2>Cat√°logo</h2>
        <div style="color:var(--muted)">Selecciona peso en <b id="current-unit">Kg</b> ‚Äî los precios listados son por Kg y por Lb</div>
      </div>

      <div id="catalogo" class="sections" aria-live="polite"></div>
    </div>

    <!-- right: cart -->
    <aside class="cart" aria-label="carrito">
      <h3>üß∫ Tu Carrito</h3>
      <ul id="cart-list" class="cart-list" role="list"></ul>

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="color:var(--muted)">Items: <b id="cart-count">0</b></div>
          <div style="font-size:18px;margin-top:6px">Total: <b id="cart-total">$0</b></div>
        </div>
      </div>

      <div class="cart-actions">
        <button class="btn-primary" id="pay-btn">Pagar</button>
        <button class="btn-secondary" id="clear-btn">Vaciar</button>
      </div>
    </aside>
  </main>

  <!-- Footer with contact & reviews -->
  <footer>
    <div class="contact">
      <h3>Cont√°ctanos</h3>
      <p class="muted">Escr√≠benos si tienes una idea o pedido especial.</p>
      <form id="contact-form">
        <input id="c-name" placeholder="Tu nombre" required />
        <input id="c-email" placeholder="Tu correo" type="email" required />
        <textarea id="c-msg" rows="4" placeholder="Tu mensaje" required></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button type="submit" class="btn-primary">Enviar</button>
          <button type="button" class="btn-secondary" id="contact-clear">Limpiar</button>
        </div>
        <p id="contact-ok" style="color:green;margin-top:8px;display:none">‚úÖ Mensaje enviado (simulado)</p>
      </form>
    </div>

    <div class="reviews">
      <h3>Rese√±as de clientes</h3>
      <div style="margin-bottom:10px;color:var(--muted)">Opiniones reales precargadas y nuevas rese√±as guardadas localmente.</div>
      <ul id="reviews-list">
        <!-- reviews appended here -->
      </ul>

      <div style="display:flex;gap:8px;margin-top:10px">
        <input id="new-review" placeholder="Comparte tu rese√±a" />
        <button class="btn-primary" id="add-review">Publicar</button>
      </div>
    </div>
  </footer>

  <!-- Modal Pago -->
  <div id="modal-pay" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <h2 id="modal-title">¬°Pago exitoso!</h2>
      <p id="modal-body" style="color:var(--muted)"></p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:14px">
        <button class="btn-primary" id="modal-close">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * Data: sections + products
     ***********************/
    const DATA = [
      {
        sectionId: 'frutas',
        title: 'Frutas',
        subsections: [
          {
            id: 'frutas-tropicales', title: 'Tropicales',
            products: [
              { id: 'mango', name:'Mango', desc:'Dulce y jugoso, perfecto para jugos.', img:'https://upload.wikimedia.org/wikipedia/commons/9/90/Hapus_Mango.jpg', priceKg:5000, offer:false },
              { id: 'pina', name:'Pi√±a', desc:'Arom√°tica y refrescante.', img:'https://upload.wikimedia.org/wikipedia/commons/c/cb/Pineapple_and_cross_section.jpg', priceKg:3000, offer:false },
              { id: 'banano', name:'Banano', desc:'Energ√≠a r√°pida, ideal para snacks.', img:'https://upload.wikimedia.org/wikipedia/commons/4/44/Bananas_white_background.jpg', priceKg:2000, offer:true },
              { id: 'guayaba', name:'Guayaba', desc:'Rica en vitamina C.', img:'https://upload.wikimedia.org/wikipedia/commons/e/e5/Guava_ID.jpg', priceKg:4000, offer:false },
              { id: 'mango-keitt', name:'Mango Keitt', desc:'Textura firme y dulce.', img:'https://upload.wikimedia.org/wikipedia/commons/4/47/KiwiFruit.jpg', priceKg:5200, offer:false }
            ]
          },
          {
            id: 'frutas-citricos', title: 'C√≠tricos',
            products: [
              { id: 'naranja', name:'Naranja', desc:'Para jugos naturales.', img:'https://upload.wikimedia.org/wikipedia/commons/c/c4/Orange-Fruit-Pieces.jpg', priceKg:4000, offer:false },
              { id: 'limon', name:'Lim√≥n Tahit√≠', desc:'√Åcido y fragante.', img:'https://upload.wikimedia.org/wikipedia/commons/5/56/Lemon.jpg', priceKg:3500, offer:false },
              { id: 'mandarina', name:'Mandarina', desc:'Dulce y f√°cil de pelar.', img:'https://upload.wikimedia.org/wikipedia/commons/d/dc/TangerineFruit.jpg', priceKg:4200, offer:true },
              { id: 'toronja', name:'Toronja', desc:'Sabor amargo y refrescante.', img:'https://upload.wikimedia.org/wikipedia/commons/3/36/Grapefruit_and_cross_section.jpg', priceKg:3800, offer:false },
              { id: 'clementina', name:'Clementina', desc:'Peque√±a y muy arom√°tica.', img:'https://upload.wikimedia.org/wikipedia/commons/a/a8/Citrus_reticulata.jpg', priceKg:4400, offer:false }
            ]
          }
        ]
      },

      {
        sectionId: 'verduras',
        title: 'Verduras',
        subsections: [
          {
            id: 'ver-hojas', title:'Hojas Verdes',
            products: [
              { id: 'espinaca', name:'Espinaca', desc:'Hoja verde, rica en hierro.', img:'https://upload.wikimedia.org/wikipedia/commons/0/03/Spinach_leaves.jpg', priceKg:2500, offer:false },
              { id: 'lechuga', name:'Lechuga', desc:'Fresca para ensaladas.', img:'https://upload.wikimedia.org/wikipedia/commons/3/38/Lettuce.jpg', priceKg:1800, offer:false },
              { id: 'kale', name:'Kale', desc:'Superalimento robusto.', img:'https://upload.wikimedia.org/wikipedia/commons/7/70/Kale-Bundle.jpg', priceKg:3500, offer:false },
              { id: 'acelga', name:'Acelga', desc:'Ideal para guisos y salteados.', img:'https://upload.wikimedia.org/wikipedia/commons/f/f1/Swiss_chard_leaves.jpg', priceKg:2200, offer:false },
              { id: 'brocoli', name:'Br√≥coli', desc:'Rico en fibra y vitaminas.', img:'https://upload.wikimedia.org/wikipedia/commons/8/8c/Broccoli_and_cross_section_edit.jpg', priceKg:3000, offer:false }
            ]
          },
          {
            id: 'ver-raices', title:'Ra√≠ces',
            products: [
              { id: 'zanahoria', name:'Zanahoria', desc:'Fuente de betacarotenos.', img:'https://upload.wikimedia.org/wikipedia/commons/0/05/Carrot.jpg', priceKg:2000, offer:false },
              { id: 'papa', name:'Papa', desc:'Vers√°til en la cocina.', img:'https://upload.wikimedia.org/wikipedia/commons/4/40/Potatoes.jpg', priceKg:1500, offer:false },
              { id: 'remolacha', name:'Remolacha', desc:'Dulce y colorida.', img:'https://upload.wikimedia.org/wikipedia/commons/6/6f/Beets-Bundle.jpg', priceKg:2300, offer:false },
              { id: 'yuca', name:'Yuca', desc:'Energ√≠a tradicional.', img:'https://upload.wikimedia.org/wikipedia/commons/d/d8/Yuca_roots.jpg', priceKg:1700, offer:false },
              { id: 'batata', name:'Batata', desc:'Dulce y nutritiva.', img:'https://upload.wikimedia.org/wikipedia/commons/6/65/SweetPotatoes.jpg', priceKg:2100, offer:true }
            ]
          }
        ]
      },

      {
        sectionId: 'granos',
        title: 'Granos & Legumbres',
        subsections: [
          {
            id:'granos-leg', title:'Legumbres',
            products:[
              { id:'frijol-negro', name:'Fr√≠jol Negro', desc:'Prote√≠na vegetal.', img:'https://upload.wikimedia.org/wikipedia/commons/3/3f/Black_beans.jpg', priceKg:3500, offer:false },
              { id:'lentejas', name:'Lentejas', desc:'Ricas y r√°pidas.', img:'https://upload.wikimedia.org/wikipedia/commons/6/6a/Lentejas.jpg', priceKg:3200, offer:false },
              { id:'garbanzos', name:'Garbanzos', desc:'Perfectos para hummus.', img:'https://upload.wikimedia.org/wikipedia/commons/f/f0/Chickpeas.jpg', priceKg:3300, offer:false },
              { id:'frijol-rojo', name:'Fr√≠jol Rojo', desc:'Cl√°sico de guisos.', img:'https://upload.wikimedia.org/wikipedia/commons/2/27/Red_kidney_beans.jpg', priceKg:3400, offer:false },
              { id:'arveja', name:'Arveja', desc:'Vers√°til y dulce.', img:'https://upload.wikimedia.org/wikipedia/commons/d/d5/Peas_in_pods_-_Studio.jpg', priceKg:3100, offer:true }
            ]
          },
          {
            id:'granos-cere', title:'Cereales',
            products:[
              { id:'maiz', name:'Ma√≠z', desc:'B√°sico y energ√©tico.', img:'https://upload.wikimedia.org/wikipedia/commons/5/5f/Maizekernels.jpg', priceKg:2200, offer:false },
              { id:'arroz', name:'Arroz', desc:'Grano esencial.', img:'https://upload.wikimedia.org/wikipedia/commons/6/6f/Rice.jpg', priceKg:2000, offer:false },
              { id:'avena', name:'Avena', desc:'Desayuno saludable.', img:'https://upload.wikimedia.org/wikipedia/commons/1/1c/Oats.jpg', priceKg:2800, offer:false },
              { id:'cebada', name:'Cebada', desc:'Buen cereal.', img:'https://upload.wikimedia.org/wikipedia/commons/b/b2/Barley.jpg', priceKg:2600, offer:false },
              { id:'quinoa', name:'Quinoa', desc:'Prote√≠nas completas.', img:'https://upload.wikimedia.org/wikipedia/commons/e/e5/Quinoa.jpg', priceKg:4000, offer:false }
            ]
          }
        ]
      },

      {
        sectionId:'ofertas', title:'Ofertas & Combos',
        subsections:[
          {
            id:'ofertas-frutas', title:'Frutas en Promoci√≥n',
            products:[
              { id:'banano-oferta', name:'Banano (promo)', desc:'Oferta por volumen.', img:'https://upload.wikimedia.org/wikipedia/commons/1/15/Bananas.jpg', priceKg:1800, offer:true },
              { id:'sandia', name:'Sand√≠a', desc:'Rebajada por temporada.', img:'https://upload.wikimedia.org/wikipedia/commons/6/6d/Watermelon.jpg', priceKg:1500, offer:true },
              { id:'aguacate', name:'Aguacate', desc:'Precio especial.', img:'https://upload.wikimedia.org/wikipedia/commons/d/d3/Avocado.jpg', priceKg:3500, offer:true },
              { id:'pera', name:'Pera', desc:'Promo limitada.', img:'https://upload.wikimedia.org/wikipedia/commons/4/47/Pear.jpg', priceKg:2800, offer:false },
              { id:'ciruela', name:'Ciruela', desc:'Dulce y jugosa.', img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Plums.jpg', priceKg:3000, offer:false }
            ]
          },
          {
            id:'ofertas-combos', title:'Combos',
            products:[
              { id:'canasta-frutas', name:'Canasta Frutas 5kg', desc:'Selecci√≥n mixta.', img:'https://upload.wikimedia.org/wikipedia/commons/4/4c/Fruit_Basket.jpg', priceKg:3600, offer:false, isCombo:true },
              { id:'combo-verduras', name:'Combo Verduras 5kg', desc:'Variedad fresca.', img:'https://upload.wikimedia.org/wikipedia/commons/d/d7/Vegetables.jpg', priceKg:3000, offer:false, isCombo:true },
              { id:'combo-granos', name:'Combo Granos 3kg', desc:'Ahorro por compra.', img:'https://upload.wikimedia.org/wikipedia/commons/a/a0/LegumeMix.jpg', priceKg:4000, offer:false, isCombo:true },
              { id:'saludable', name:'Pack Saludable', desc:'Frutas + Hortalizas.', img:'https://upload.wikimedia.org/wikipedia/commons/c/cd/HealthyFood.jpg', priceKg:5000, offer:false, isCombo:true },
              { id:'canasta-mixta', name:'Canasta Mixta 10kg', desc:'Especial familiar.', img:'https://upload.wikimedia.org/wikipedia/commons/6/6b/MarketBasket.jpg', priceKg:3500, offer:false, isCombo:true }
            ]
          }
        ]
      }
    ];

    /***********************
     * State
     ***********************/
    const STORAGE_KEY = 'fruver_cart_v2';
    const REVIEWS_KEY = 'fruver_reviews_v2';
    let cart = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let reviews = JSON.parse(localStorage.getItem(REVIEWS_KEY) || '["Excelente calidad y frescura.","Entrega muy puntual.","Productos con muy buena presentaci√≥n."]');

    /***********************
     * Helpers
     ***********************/
    function formatMoney(n){
      return Number(n).toLocaleString('es-CO');
    }
    function lbPriceFromKg(kgPrice){ // precio por libra = precio_kg * 0.453592...
      return Math.round(kgPrice * 0.453592);
    }
    function kgFromInput(weight, unit){
      const w = Number(weight) || 0;
      if(unit === 'kg') return w;
      return w * 0.453592;
    }

    /***********************
     * Render catalog dynamically
     ***********************/
    function renderCatalog(){
      const container = document.getElementById('catalogo');
      container.innerHTML = ''; // clear
      DATA.forEach(section => {
        // section title block
        const secWrap = document.createElement('div');
        secWrap.className = 'section-block';
        const secTitle = document.createElement('div');
        secTitle.className = 'subsection';
        const h3 = document.createElement('h3');
        h3.textContent = section.title;
        h3.style.fontSize = '18px';
        h3.style.marginBottom = '8px';
        secTitle.appendChild(h3);

        // each subsection
        section.subsections.forEach(sub => {
          const subEl = document.createElement('div');
          subEl.className = 'subsection';
          const subtitle = document.createElement('h3');
          subtitle.innerHTML = (sub.title) ? `üçÉ ${sub.title}` : sub.title;
          subEl.appendChild(subtitle);

          const hint = document.createElement('div');
          hint.className = 'hint';
          hint.textContent = 'Precio por Kg y por Lb. Ingresa la cantidad en la unidad seleccionada arriba.';
          subEl.appendChild(hint);

          const grid = document.createElement('div');
          grid.className = 'grid-products';

          sub.products.forEach(p => {
            const card = document.createElement('article');
            card.className = 'card';
            // ribbon for offers
            if(p.offer){
              const r = document.createElement('div'); r.className = 'ribbon'; r.textContent='OFERTA';
              card.appendChild(r);
            }

            const media = document.createElement('div'); media.className='media';
            const img = document.createElement('img'); img.src = p.img; img.alt = p.name;
            media.appendChild(img);

            const title = document.createElement('h4'); title.textContent = p.name;
            const desc = document.createElement('p'); desc.className='desc'; desc.textContent = p.desc;

            const priceRow = document.createElement('div'); priceRow.className='price-row';
            const price = document.createElement('div'); price.className='price';
            price.innerHTML = `$${formatMoney(p.priceKg)} / Kg`;
            const small = document.createElement('small');
            small.textContent = `| $${formatMoney(lbPriceFromKg(p.priceKg))} / Lb`;
            price.appendChild(small);
            priceRow.appendChild(price);

            // controls
            const controls = document.createElement('div'); controls.className='controls';
            const input = document.createElement('input');
            input.type = 'number'; input.min='0.1'; input.step='0.1';
            input.value = p.isCombo ? 1 : 0.5; // combos default 1 (represent weight placeholder)
            input.title = `Peso para ${p.name}`;
            input.id = `w_${p.id}`; // unique id
            const btn = document.createElement('button');
            btn.className='btn-add';
            btn.textContent = 'Agregar';
            btn.onclick = () => {
              const unit = document.getElementById('unit-select').value;
              const value = Number(document.getElementById(input.id).value);
              addToCart(p, value, unit);
            };

            controls.appendChild(input);
            controls.appendChild(btn);

            card.appendChild(media);
            card.appendChild(title);
            card.appendChild(desc);
            card.appendChild(priceRow);
            card.appendChild(controls);

            grid.appendChild(card);
          });

          subEl.appendChild(grid);
          secTitle.appendChild(subEl);
        });

        container.appendChild(secTitle);
      });
    }

    /***********************
     * Cart functions
     ***********************/
    function persistCart(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
    }

    function addToCart(product, weight, unit){
      if(!weight || weight <= 0){
        alert('Ingresa un peso v√°lido.');
        return;
      }
      // convert weight to kg for pricing calculation
      const weightKg = kgFromInput(weight, unit);
      const subtotal = Math.round(weightKg * product.priceKg);
      // store item
      const item = {
        id: product.id,
        name: product.name,
        img: product.img,
        weightEntered: weight,
        unitEntered: unit,
        weightKg,
        pricePerKg: product.priceKg,
        subtotal
      };
      cart.push(item);
      persistCart();
      renderCart();
      showToast(`${product.name} agregado`);
    }

    function removeCartItem(index){
      cart.splice(index,1);
      persistCart();
      renderCart();
    }

    function clearCart(){
      if(!confirm('¬øVaciar carrito?')) return;
      cart = [];
      persistCart();
      renderCart();
    }

    function calcTotal(){
      return cart.reduce((s,i)=>s + (i.subtotal||0), 0);
    }

    function renderCart(){
      const list = document.getElementById('cart-list');
      list.innerHTML = '';
      if(cart.length === 0){
        const empty = document.createElement('div');
        empty.style.color = 'var(--muted)';
        empty.style.padding = '10px';
        empty.textContent = 'Tu carrito est√° vac√≠o.';
        list.appendChild(empty);
      } else {
        cart.forEach((it, idx) => {
          const li = document.createElement('li');
          li.className = 'cart-item';
          const img = document.createElement('img'); img.src = it.img; img.alt = it.name;
          const meta = document.createElement('div'); meta.className = 'meta';
          meta.innerHTML = `<b>${it.name}</b><small>${it.weightEntered} ${it.unitEntered} ‚Ä¢ $${formatMoney(it.subtotal)}</small>`;
          const btn = document.createElement('button'); btn.className='btn-secondary'; btn.textContent='Eliminar';
          btn.onclick = ()=> removeCartItem(idx);
          li.appendChild(img); li.appendChild(meta); li.appendChild(btn);
          list.appendChild(li);
        });
      }
      document.getElementById('cart-count').textContent = cart.length;
      document.getElementById('cart-total').textContent = '$' + formatMoney(calcTotal());
    }

    /***********************
     * Pay modal
     ***********************/
    function openPayModal(){
      if(cart.length === 0){
        alert('El carrito est√° vac√≠o.');
        return;
      }
      const total = calcTotal();
      document.getElementById('modal-title').textContent = '¬°Pago exitoso!';
      document.getElementById('modal-body').textContent = `Total pagado: $${formatMoney(total)} ‚Äî Gracias por tu compra.`;
      document.getElementById('modal-pay').style.display = 'flex';
      // empty cart after payment
      cart = [];
      persistCart();
      renderCart();
    }
    function closePayModal(){
      document.getElementById('modal-pay').style.display = 'none';
    }

    /***********************
     * Reviews & Contact
     ***********************/
    function renderReviews(){
      const ul = document.getElementById('reviews-list');
      ul.innerHTML = '';
      reviews.forEach(r => {
        const li = document.createElement('li'); li.className='review';
        li.innerHTML = `<strong>‚≠ê</strong> <span style="margin-left:8px">${r}</span>`;
        ul.appendChild(li);
      });
    }
    function addReview(){
      const input = document.getElementById('new-review');
      const text = input.value.trim();
      if(!text) return;
      reviews.unshift(text); // newest first
      localStorage.setItem(REVIEWS_KEY, JSON.stringify(reviews));
      input.value = '';
      renderReviews();
    }

    function handleContact(e){
      e.preventDefault();
      const name = document.getElementById('c-name').value.trim();
      const email = document.getElementById('c-email').value.trim();
      const msg = document.getElementById('c-msg').value.trim();
      if(!name || !email || !msg){ alert('Completa todos los campos'); return; }
      // simulate send
      document.getElementById('contact-ok').style.display = 'block';
      setTimeout(()=> document.getElementById('contact-ok').style.display = 'none', 3000);
      e.target.reset();
    }

    /***********************
     * Small UI helpers
     ***********************/
    let toastTimer = null;
    function showToast(text){
      // transient non-blocking small toast at bottom-right
      let el = document.getElementById('__toast');
      if(!el){
        el = document.createElement('div');
        el.id='__toast';
        Object.assign(el.style,{position:'fixed',right:'18px',bottom:'18px',background:'#081',color:'#fff',padding:'10px 14px',borderRadius:'12px',boxShadow:'0 8px 24px rgba(0,0,0,0.18)',fontWeight:700,zIndex:9999,opacity:0,transform:'translateY(10px)',transition:'all .32s'});
        document.body.appendChild(el);
      }
      el.textContent = text;
      el.style.opacity = 1; el.style.transform='translateY(0)';
      if(toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ el.style.opacity=0; el.style.transform='translateY(10px)'; },1500);
    }

    /***********************
     * Init
     ***********************/
    document.addEventListener('DOMContentLoaded', ()=>{
      // render catalog
      renderCatalog();
      // initial UI
      document.getElementById('unit-select').addEventListener('change', (e)=>{
        document.getElementById('current-unit').textContent = (e.target.value === 'kg') ? 'Kg' : 'Lb';
      });

      // attach cart actions
      document.getElementById('pay-btn').addEventListener('click', openPayModal);
      document.getElementById('clear-btn').addEventListener('click', clearCart);
      document.getElementById('modal-close').addEventListener('click', closePayModal);
      document.getElementById('modal-pay').addEventListener('click', (ev)=>{ if(ev.target.id === 'modal-pay') closePayModal(); });

      // reviews & contact
      renderReviews();
      document.getElementById('add-review').addEventListener('click', addReview);
      document.getElementById('contact-form').addEventListener('submit', handleContact);
      document.getElementById('contact-clear').addEventListener('click', ()=> document.getElementById('contact-form').reset());

      // render cart from storage
      renderCart();
    });

    // Expose some functions for console / testing
    window.mostrarSeccion = function(){ alert('Para navegar usa el cat√°logo: selecciona la secci√≥n arriba.'); };
    // The header button "Cat√°logo" calls mostrarSeccion('catalogo') - we simply scroll the catalog into view:
    document.querySelectorAll('.btn-ghost').forEach(b=> b.addEventListener('click', ()=> {
      document.getElementById('catalogo').scrollIntoView({behavior:'smooth'});
    }));
  </script>
</body>
</html>
